import{r as h,at as Ee,j as e,s as K,P as rt,_ as E,k as Te,o as at,a7 as it,au as F,f as nt,l as Re,n as st,q as ot,ac as ve,ab as Ae,av as J,aw as ne,w as lt,ax as ee,T as M,I as B,B as v,z as Be,t as ze,a5 as Y,d as ue,ay as ct,S as ut,L as dt,y as mt,b as _e,M as H,x as ht,D as pt,H as ft}from"./index-DNJ-7_Rf.js";import{C as xt}from"./config-global-CwnLHF89.js";import{u as O}from"./useQuery-Cikl35b1.js";import{h as bt,i as gt}from"./iot-Dg2SjAsq.js";import{f as jt}from"./utils-DgT3aVHO.js";import{C as U}from"./Card-98N49c-B.js";import{C as Pe}from"./CardHeader-BODd0mTE.js";import{T as yt}from"./Tooltip-DbXBuVyG.js";import{S as vt}from"./Slider-CXET07Dr.js";import{G as N}from"./Grid-BaR81AYS.js";import{M as St,g as wt,R as Mt}from"./ranches-grid-DSJ9mZbC.js";import{u as Fe,c as Ct,I as Tt,M as kt}from"./index.modern-BSJ2A2Eu.js";import{R as Rt,f as Pt}from"./admin-clusters-CbYe47uX.js";import{S as De,z as He,E as ke}from"./index-DnZn71We.js";import{u as Ne}from"./useMediaQuery-BWWVbJPQ.js";import{f as de,g as Nt}from"./format-time-Ca3E0HHB.js";import{c as se,d as x,T as Ke,a as Ve,b as Ye,e as Oe}from"./TableRow-DysWAKuU.js";import{C as Ue}from"./CardContent-DR76uJN9.js";import{u as Xe,b as y,g as qe,d as Lt,S as It,e as Wt}from"./sortable-table-cell-4A-9xpJw.js";import{T as Ge}from"./table-loading-DNHH0sRX.js";import{g as At}from"./user-stations-CWKvNGeL.js";import{F as oe,I as le,S as ce}from"./Select-C6NYPjTS.js";import{S as Qe}from"./Stack-BvggcJT0.js";import{T as Dt,a as te}from"./Tabs-D274aWzn.js";import"./es-AKIt1KYa.js";import"./en-US-B7LV0LqM.js";import"./Popper-yRRR-Rwr.js";import"./useControlled-CYejl48w.js";import"./charts-CQznrqcz.js";import"./index-KKIBTe8w.js";import"./colorManipulator-CN4-k9CK.js";import"./use-debounce-BKmKytjS.js";import"./TextField-DrqQKz-z.js";import"./KeyboardArrowRight-DgOaYwjI.js";function $t(t){const{children:r,defer:l=!1,fallback:n=null}=t,[s,c]=h.useState(!1);return Ee(()=>{l||c(!0)},[l]),h.useEffect(()=>{l&&c(!0)},[l]),e.jsx(h.Fragment,{children:s?r:n})}const Et=["anchor","classes","className","width","style"],Bt=K("div",{shouldForwardProp:rt})(({theme:t,ownerState:r})=>E({position:"fixed",top:0,left:0,bottom:0,zIndex:t.zIndex.drawer-1},r.anchor==="left"&&{right:"auto"},r.anchor==="right"&&{left:"auto",right:0},r.anchor==="top"&&{bottom:"auto",right:0},r.anchor==="bottom"&&{top:"auto",bottom:0,right:0})),zt=h.forwardRef(function(r,l){const{anchor:n,classes:s={},className:c,width:i,style:o}=r,a=Te(r,Et),d=r;return e.jsx(Bt,E({className:at("PrivateSwipeArea-root",s.root,s[`anchor${it(n)}`],c),ref:l,style:E({[F(n)?"width":"height"]:i},o),ownerState:d},a))}),_t=["BackdropProps"],Ft=["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","allowSwipeInChildren","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"],re=3,Se=20;let $=null;function we(t,r,l){return t==="right"?l.body.offsetWidth-r[0].pageX:r[0].pageX}function Me(t,r,l){return t==="bottom"?l.innerHeight-r[0].clientY:r[0].clientY}function V(t,r){return t?r.clientWidth:r.clientHeight}function $e(t,r,l,n){return Math.min(Math.max(l?r-t:n+r-t,0),n)}function Ht(t,r){const l=[];for(;t&&t!==r.parentElement;){const n=ne(r).getComputedStyle(t);n.getPropertyValue("position")==="absolute"||n.getPropertyValue("overflow-x")==="hidden"||(t.clientWidth>0&&t.scrollWidth>t.clientWidth||t.clientHeight>0&&t.scrollHeight>t.clientHeight)&&l.push(t),t=t.parentElement}return l}function Kt({domTreeShapes:t,start:r,current:l,anchor:n}){const s={scrollPosition:{x:"scrollLeft",y:"scrollTop"},scrollLength:{x:"scrollWidth",y:"scrollHeight"},clientLength:{x:"clientWidth",y:"clientHeight"}};return t.some(c=>{let i=l>=r;(n==="top"||n==="left")&&(i=!i);const o=n==="left"||n==="right"?"x":"y",a=Math.round(c[s.scrollPosition[o]]),d=a>0,p=a+c[s.clientLength[o]]<c[s.scrollLength[o]];return!!(i&&p||!i&&d)})}const Vt=typeof navigator<"u"&&/iPad|iPhone|iPod/.test(navigator.userAgent),Yt=h.forwardRef(function(r,l){const n=nt({name:"MuiSwipeableDrawer",props:r}),s=Re(),c={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{anchor:i="left",disableBackdropTransition:o=!1,disableDiscovery:a=!1,disableSwipeToOpen:d=Vt,hideBackdrop:p,hysteresis:g=.52,allowSwipeInChildren:b=!1,minFlingVelocity:T=450,ModalProps:{BackdropProps:f}={},onClose:I,onOpen:X,open:S=!1,PaperProps:me={},SwipeAreaProps:Ze,swipeAreaWidth:he=20,transitionDuration:pe=c,variant:z="temporary"}=n,Je=Te(n.ModalProps,_t),et=Te(n,Ft),[Ie,fe]=h.useState(!1),u=h.useRef({isSwiping:null}),xe=h.useRef(),be=h.useRef(),C=h.useRef(),tt=st(me.ref,C),q=h.useRef(!1),ge=h.useRef();Ee(()=>{ge.current=null},[S]);const G=h.useCallback((m,L={})=>{const{mode:j=null,changeTransition:w=!0}=L,k=ee(s,i),R=["right","bottom"].indexOf(k)!==-1?1:-1,A=F(i),W=A?`translate(${R*m}px, 0)`:`translate(0, ${R*m}px)`,_=C.current.style;_.webkitTransform=W,_.transform=W;let P="";if(j&&(P=s.transitions.create("all",ot({easing:void 0,style:void 0,timeout:pe},{mode:j}))),w&&(_.webkitTransition=P,_.transition=P),!o&&!p){const D=be.current.style;D.opacity=1-m/V(A,C.current),w&&(D.webkitTransition=P,D.transition=P)}},[i,o,p,s,pe]),Q=ve(m=>{if(!q.current)return;if($=null,q.current=!1,Ae.flushSync(()=>{fe(!1)}),!u.current.isSwiping){u.current.isSwiping=null;return}u.current.isSwiping=null;const L=ee(s,i),j=F(i);let w;j?w=we(L,m.changedTouches,J(m.currentTarget)):w=Me(L,m.changedTouches,ne(m.currentTarget));const k=j?u.current.startX:u.current.startY,R=V(j,C.current),A=$e(w,k,S,R),W=A/R;if(Math.abs(u.current.velocity)>T&&(ge.current=Math.abs((R-A)/u.current.velocity)*1e3),S){u.current.velocity>T||W>g?I():G(0,{mode:"exit"});return}u.current.velocity<-T||1-W>g?X():G(V(j,C.current),{mode:"enter"})}),We=(m=!1)=>{if(!Ie){(m||!(a&&b))&&Ae.flushSync(()=>{fe(!0)});const L=F(i);!S&&C.current&&G(V(L,C.current)+(a?15:-Se),{changeTransition:!1}),u.current.velocity=0,u.current.lastTime=null,u.current.lastTranslate=null,u.current.paperHit=!1,q.current=!0}},je=ve(m=>{if(!C.current||!q.current||$!==null&&$!==u.current)return;We(!0);const L=ee(s,i),j=F(i),w=we(L,m.touches,J(m.currentTarget)),k=Me(L,m.touches,ne(m.currentTarget));if(S&&C.current.contains(m.target)&&$===null){const P=Ht(m.target,C.current);if(Kt({domTreeShapes:P,start:j?u.current.startX:u.current.startY,current:j?w:k,anchor:i})){$=!0;return}$=u.current}if(u.current.isSwiping==null){const P=Math.abs(w-u.current.startX),D=Math.abs(k-u.current.startY),Z=j?P>D&&P>re:D>P&&D>re;if(Z&&m.cancelable&&m.preventDefault(),Z===!0||(j?D>re:P>re)){if(u.current.isSwiping=Z,!Z){Q(m);return}u.current.startX=w,u.current.startY=k,!a&&!S&&(j?u.current.startX-=Se:u.current.startY-=Se)}}if(!u.current.isSwiping)return;const R=V(j,C.current);let A=j?u.current.startX:u.current.startY;S&&!u.current.paperHit&&(A=Math.min(A,R));const W=$e(j?w:k,A,S,R);if(S)if(u.current.paperHit)W===0&&(u.current.startX=w,u.current.startY=k);else if(j?w<R:k<R)u.current.paperHit=!0,u.current.startX=w,u.current.startY=k;else return;u.current.lastTranslate===null&&(u.current.lastTranslate=W,u.current.lastTime=performance.now()+1);const _=(W-u.current.lastTranslate)/(performance.now()-u.current.lastTime)*1e3;u.current.velocity=u.current.velocity*.4+_*.6,u.current.lastTranslate=W,u.current.lastTime=performance.now(),m.cancelable&&m.preventDefault(),G(W)}),ye=ve(m=>{if(m.defaultPrevented||m.defaultMuiPrevented||S&&(p||!be.current.contains(m.target))&&!C.current.contains(m.target))return;const L=ee(s,i),j=F(i),w=we(L,m.touches,J(m.currentTarget)),k=Me(L,m.touches,ne(m.currentTarget));if(!S){var R;if(d||!(m.target===xe.current||(R=C.current)!=null&&R.contains(m.target)&&(typeof b=="function"?b(m,xe.current,C.current):b)))return;if(j){if(w>he)return}else if(k>he)return}m.defaultMuiPrevented=!0,$=null,u.current.startX=w,u.current.startY=k,We()});return h.useEffect(()=>{if(z==="temporary"){const m=J(C.current);return m.addEventListener("touchstart",ye),m.addEventListener("touchmove",je,{passive:!S}),m.addEventListener("touchend",Q),()=>{m.removeEventListener("touchstart",ye),m.removeEventListener("touchmove",je,{passive:!S}),m.removeEventListener("touchend",Q)}}},[z,S,ye,je,Q]),h.useEffect(()=>()=>{$===u.current&&($=null)},[]),h.useEffect(()=>{S||fe(!1)},[S]),e.jsxs(h.Fragment,{children:[e.jsx(lt,E({open:z==="temporary"&&Ie?!0:S,variant:z,ModalProps:E({BackdropProps:E({},f,{ref:be})},z==="temporary"&&{keepMounted:!0},Je),hideBackdrop:p,PaperProps:E({},me,{style:E({pointerEvents:z==="temporary"&&!S&&!b?"none":""},me.style),ref:tt}),anchor:i,transitionDuration:ge.current||pe,onClose:I,ref:l},et)),!d&&z==="temporary"&&e.jsx($t,{children:e.jsx(zt,E({anchor:i,ref:xe,width:he},Ze))})]})}),Ot=K("div")(()=>({position:"absolute",display:"flex",alignItems:"center",right:0,transform:"translateY(-50%)"})),Ut=K("div")(({color:t})=>({width:"3rem",borderTop:`2px dashed ${t}`})),Xt=K("span")(({color:t})=>({marginLeft:"8px",fontSize:"0.75rem",color:t}));function qt({bottomLimit:t,topLimit:r,soilMoisture:l,lastMeasurement:n,name:s,desiredValue:c,deviceId:i}){const o=t?Number(t):0,a=r?Number(r):100,d=c?Number(c):null,p=10,g=50,b=f=>f?(f-p)/(g-p)*100:0,T=[{value:b(o),color:"#ff0000",label:`${o}`,condition:o>=p},{value:b(a),color:"#0b2af1",label:`${a}`,condition:a<=g}].filter(({condition:f})=>f);return e.jsxs(U,{sx:{width:"100%",position:"relative",height:"100%"},children:[e.jsx(Pe,{title:e.jsx(yt,{title:i,children:e.jsx(M,{fontWeight:"500",children:s||"sin nombre"})}),subheader:`${jt(n)}`,sx:{padding:1.5,paddingBottom:0},titleTypographyProps:{variant:"body1",fontWeight:"medium"},subheaderTypographyProps:{variant:"body2",fontSize:"0.75rem"},avatar:e.jsx(B,{icon:"solar:waterdrops-line-duotone"})}),e.jsxs(v,{px:3,height:200,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",my:2,sx:{paddingLeft:8},children:[e.jsx(v,{position:"absolute",height:"90%",right:"30%",sx:{transform:"translateX(12px)"},children:T.map(({value:f,color:I,label:X})=>e.jsx(v,{position:"absolute",style:{bottom:`${f}%`,width:"100%"},children:e.jsxs(Ot,{color:I,children:[e.jsx(Ut,{color:I}),e.jsx(Xt,{color:I,children:X})]})},X))}),e.jsx(vt,{track:!1,marks:[{value:0,label:`${p}%`},{value:b(d),label:c?`${c}%`:""},{value:100,label:`${g}%`}].filter(Boolean),orientation:"vertical",value:l?b(Number(l)):0,valueLabelFormat:()=>l,disabled:!0,valueLabelDisplay:"on",sx:{height:"90%",width:8,"& .MuiSlider-rail":{background:"linear-gradient(to top, #f10b0b, #f1ee0b, #0b2af1)",opacity:1},"& .MuiSlider-thumb":{backgroundColor:"#fff",border:"2px solid currentColor",width:16,height:16}}})]})]})}const Gt=({sensors:t})=>t.length?e.jsxs(N,{item:!0,xs:12,md:6,sx:{height:"100%",overflowY:"auto"},children:[" ",e.jsxs(v,{sx:{display:"inline-flex",alignItems:"center",backgroundColor:"error.main",color:"white",borderRadius:"16px",px:1,py:.5,gap:.5,mb:1},children:[e.jsx(v,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"white",animation:"pulse 1.5s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}}}),e.jsx(M,{variant:"caption",sx:{fontWeight:"bold"},children:"En vivo"})]}),e.jsx(N,{container:!0,spacing:2,children:t.map(r=>{var l;return e.jsx(N,{item:!0,padding:1,xs:6,sm:4,md:6,children:e.jsx(Be,{to:`/iot/sensor/${r.device_id}`,style:{textDecoration:"none",color:"inherit",width:"100%"},children:e.jsx(qt,{bottomLimit:r!=null&&r.limite_inferior?String(r==null?void 0:r.limite_inferior):null,topLimit:r!=null&&r.limite_superior?String(r==null?void 0:r.limite_superior):null,soilMoisture:(l=r==null?void 0:r.last_measurement)==null?void 0:l.agua_suelo,lastMeasurement:r.last_measurement.timestamp,name:r==null?void 0:r.nombre,desiredValue:r==null?void 0:r.capacidadIdeal,deviceId:r.device_id})})},r.device_id)})})]}):e.jsx(M,{variant:"h6",mt:3,children:"No tienes sensores asignados"}),Qt=({selectedArea:t,setSelectedArea:r,areas:l})=>{const n=Fe(),[s,c]=h.useState(new Map),i=h.useCallback(o=>{if(!n)return;const a=new google.maps.LatLngBounds;o.getPath().forEach(d=>{a.extend(d)}),setTimeout(()=>{n.fitBounds(a)},100)},[n]);return h.useEffect(()=>{if(!n)return;const o=new Map;return l.forEach(a=>{const d=new google.maps.Polygon({paths:a.boundaryPoints,map:n,fillColor:t===a.id?"#4285f4":"#ff0000",fillOpacity:.35,strokeColor:t===a.id?"#4285f4":"#ff0000",strokeOpacity:1,strokeWeight:2});d.addListener("click",()=>{r(a.id),i(d)}),o.set(a.id,d)}),c(o),()=>{o.forEach(a=>{google.maps.event.clearInstanceListeners(a),a.setMap(null)})}},[n,l,i,t,r]),h.useEffect(()=>{s.forEach((o,a)=>{const d=t===a;o.setOptions({fillColor:d?"#4285f4":"#ff0000",strokeColor:d?"#4285f4":"#ff0000"})})},[t,s]),h.useEffect(()=>{if(t&&s.has(t)){const o=s.get(t);o&&i(o)}},[t,s,i]),null},Zt=({position:t,color:r,name:l,deviceId:n,setMarkerRef:s})=>{const[c,i]=h.useState(!1),[o,a]=h.useState(null);h.useEffect(()=>{(async()=>{const T=await bt(n);T&&a(T)})()},[n]);const d=()=>{i(b=>!b)},p=()=>i(!1),g=h.useCallback(b=>s(b,n),[s,n]);return e.jsxs(e.Fragment,{children:[e.jsx(Ct,{position:t,onClick:d,ref:g,children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"36px",height:"36px",backgroundColor:"#FFF",borderRadius:"50%",border:`2px solid ${r}`,color:"#000",fontSize:"12px",fontWeight:"bold",textAlign:"center"},children:(o==null?void 0:o.ultimaMedicion.agua_suelo)??"-"})}),c&&e.jsx(Tt,{position:t,onCloseClick:p,children:e.jsxs(v,{sx:{p:.5},children:[e.jsx(M,{variant:"subtitle1",component:"h2",children:l}),e.jsxs(M,{variant:"body2",children:["Temperatura del Suelo: ",o==null?void 0:o.ultimaMedicion.temperatura_suelo,"°C"]}),e.jsxs(M,{variant:"body2",children:["Humedad del Suelo: ",o==null?void 0:o.ultimaMedicion.agua_suelo,"%"]}),e.jsxs(M,{variant:"body2",children:["Conductividad del Suelo: ",o==null?void 0:o.ultimaMedicion.conductividad_suelo,"uS/cm"]})]})})]})},Jt=(t,r)=>{const l=new Map;return t.forEach(n=>{if(n.rancho&&n.rancho.id&&n.rancho.area&&r.includes(n.rancho.nombre||"")&&!l.has(n.rancho.id))try{const s=JSON.parse(n.rancho.area);if(s.coordenadas&&Array.isArray(s.coordenadas)){let c;Array.isArray(s.coordenadas[0])&&Array.isArray(s.coordenadas[0][0])&&typeof s.coordenadas[0][0][0]=="number"?c=s.coordenadas.map(i=>i.map(o=>({lat:o[0],lng:o[1]}))):Array.isArray(s.coordenadas[0])&&typeof s.coordenadas[0][0]=="object"?c=s.coordenadas.map(i=>i.map(o=>({lat:o.lat,lng:o.lng}))):s.coordenadas.every(i=>i.lat&&i.lng)&&(c=s.coordenadas),(Array.isArray(c[0])?c.every(i=>i.every(o=>o.lat&&o.lng)):c.every(i=>i.lat&&i.lng))&&l.set(n.rancho.id,{id:n.rancho.id,name:n.rancho.nombre,boundaryPoints:c})}}catch(s){console.log(`Error parsing area for ranch ${n.rancho.id}:`,s)}}),Array.from(l.values())},er=({sensors:t})=>{const r=Fe(),[l,n]=h.useState({});h.useEffect(()=>{if(!r||!t.length)return;const i=new google.maps.LatLngBounds;t.forEach(o=>{o!=null&&o.lat&&(o!=null&&o.long)&&i.extend({lat:Number(o.lat),lng:Number(o.long)})}),r.fitBounds(i,10)},[r,t]);const s=h.useMemo(()=>r?new St({map:r}):null,[r]);h.useEffect(()=>{s&&(s.clearMarkers(),s.addMarkers(Object.values(l)))},[s,l]);const c=h.useCallback((i,o)=>{n(a=>{if(i&&a[o]||!i&&!a[o])return a;if(i)return{...a,[o]:i};const{[o]:d,...p}=a;return p})},[]);return e.jsx(e.Fragment,{children:t.map(i=>e.jsx(Zt,{setMarkerRef:c,position:{lat:Number(i.lat),lng:Number(i.long)},color:i.color,name:i.nombre||"Sin nombre",deviceId:i.device_id},i.device_id))})},tr=({sensors:t,ranches:r})=>{const[l,n]=h.useState(null);if(!t.length)return null;const s=t.filter(a=>(a==null?void 0:a.lat)&&(a==null?void 0:a.long)),c=s.length?s.reduce((a,d)=>a+Number(d.lat),0)/s.length:0,i=s.length?s.reduce((a,d)=>a+Number(d.long),0)/s.length:0,o=Jt(t,r);return e.jsx(N,{item:!0,xs:12,md:6,children:e.jsx(Rt,{children:e.jsx(v,{sx:{position:"relative",height:{xs:"600px",md:"100%"}},children:e.jsxs(kt,{streetViewControl:!1,defaultZoom:5,defaultCenter:{lat:c,lng:i},mapTypeId:"satellite",gestureHandling:"greedy",mapTypeControl:!1,mapId:"f1b7b1b3b1b3b1b3",zoomControl:!1,children:[e.jsx(Qt,{selectedArea:l,setSelectedArea:n,areas:o}),e.jsx(er,{sensors:s})]})})})})},rr=()=>e.jsxs(e.Fragment,{children:[e.jsx(N,{item:!0,xs:12,md:6,sx:{height:"100%",overflowY:"auto"},children:e.jsx(N,{container:!0,spacing:2,children:[...Array(6)].map((t,r)=>e.jsx(N,{item:!0,padding:1,xs:6,sm:4,md:6,children:e.jsx(De,{variant:"rectangular",height:"20rem",sx:{borderRadius:2}})},r))})}),e.jsx(N,{item:!0,xs:12,md:6,sx:{height:{xs:"600px",md:"100%"}},children:e.jsx(De,{variant:"rectangular",height:"100%",sx:{borderRadius:2}})})]}),Le=async t=>{if(!t)throw new Error("userId must be provided");try{const r=await fetch(`${ze}/api/rancho/user/${t}`);if(!r.ok)throw new Error("Network response was not ok");const l=await r.json();return Pt.parse(l)}catch(r){throw r instanceof He.ZodError?new Error("Se ha producido un error al validar los datos"):new Error(r)}},ar=()=>{const{userData:t}=Y(),[r,l]=h.useState([]),[n,s]=h.useState(!1),{data:c}=O({queryKey:["user-ranches",t==null?void 0:t.id],queryFn:()=>Le(t==null?void 0:t.id),enabled:!!(t!=null&&t.id)}),i=(c==null?void 0:c.map(a=>a.name).filter(a=>a!==null))||[],o=h.useCallback(async()=>{if(!t)return;s(!0);const d=(await gt(t==null?void 0:t.id)).map(p=>!p.lat||!p.long?{...p,color:"#ff0000"}:{...p,color:wt({capacidadIdeal:p.capacidadIdeal,limite_inferior:p.limite_inferior,limite_superior:p.limite_superior,agua_suelo:p.last_measurement.agua_suelo})}).sort((p,g)=>p.nombre?g.nombre?p.nombre.localeCompare(g.nombre,void 0,{numeric:!0}):-1:1);l(d),s(!1)},[t]);return h.useEffect(()=>{o()},[o,t]),e.jsx(N,{container:!0,spacing:2,mt:2,sx:{height:{xs:"auto",md:"calc(100vh - 19rem)"},position:"relative"},children:n?e.jsx(rr,{}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{"aria-label":"actualizar",sx:{position:"absolute",top:-40,right:0},onClick:()=>o(),children:e.jsx(B,{icon:"solar:restart-circle-line-duotone",width:35})}),e.jsx(Gt,{sensors:r}),e.jsx(tr,{sensors:r,ranches:i})]})})},Ce=56,ir=K("div")(()=>({backgroundColor:"#fff",boxShadow:"0 0 2px 0 rgba(145 158 171 / 0.2), 0 12px 24px -4px rgba(145 158 171 / 0.12)"})),nr=K("div")(()=>({width:30,height:6,backgroundColor:"#637381",borderRadius:3,position:"absolute",top:8,left:"calc(50% - 15px)"})),sr=()=>{const{userData:t}=Y(),{data:r}=O({queryKey:["user-ranchs",t==null?void 0:t.id],queryFn:()=>Le(t==null?void 0:t.id),enabled:!!(t!=null&&t.id)}),[l,n]=h.useState(!1),s=i=>()=>{n(i)};return!Ne("(max-width:600px)")||!(r!=null&&r.length)?null:e.jsxs(e.Fragment,{children:[e.jsx(ct,{styles:{".MuiDrawer-root > .MuiPaper-root":{height:`calc(60% - ${Ce}px)`,overflow:"visible"}}}),e.jsxs(Yt,{anchor:"bottom",open:l,onClose:s(!1),onOpen:s(!0),swipeAreaWidth:Ce,disableSwipeToOpen:!1,ModalProps:{keepMounted:!0},children:[e.jsxs(ir,{sx:{position:"absolute",top:-Ce,borderTopLeftRadius:8,borderTopRightRadius:8,visibility:"visible",right:0,left:0},children:[e.jsx(nr,{}),e.jsx(M,{sx:{p:2,color:"text.secondary"},children:"Ranchos"})]}),e.jsx(v,{sx:{px:2,pb:2,height:"100%",overflow:"auto",backgroundColor:"#ffffff"},children:e.jsx(ut,{children:e.jsx(dt,{children:r.map(i=>e.jsx(mt,{children:e.jsx(Be,{to:`/ranch/${i.id}?name=${i.name}`,style:{textDecoration:"inherit",color:"inherit"},children:i.name})},crypto.randomUUID()))})})})]})]})},or=({station:t,idx:r})=>{const l=_e();return e.jsxs(se,{sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},backgroundColor:r%2===0?"rgba(255,255,255)":"rgba(250,250,250)"},onClick:()=>l.push(`/weather-stations/${t.devEui}`),children:[e.jsx(x,{children:t.devEui}),e.jsx(x,{children:t.deviceName}),e.jsx(x,{children:t.grupoName}),e.jsxs(x,{children:[t.latestMeasurement.temperature,"°C"]}),e.jsxs(x,{children:[t.latestMeasurement.humidity,"%"]}),e.jsx(x,{children:t.latestMeasurement.light}),e.jsx(x,{children:t.latestMeasurement.uv}),e.jsx(x,{children:t.latestMeasurement.windSpeed}),e.jsx(x,{children:t.latestMeasurement.windDirection}),e.jsx(x,{children:t.latestMeasurement.rainfall}),e.jsx(x,{children:t.latestMeasurement.pressure}),e.jsx(x,{children:t.latestMeasurement.rssi}),e.jsx(x,{children:t.latestMeasurement.snr}),e.jsx(x,{children:de(t.latestMeasurement.timestamp)})]},t.id)},lr=({station:t,idx:r,totalStations:l})=>{const n=_e(),s=()=>{n.push(`/weather-stations/${t.devEui}`)},c=[{label:"Temp",value:`${t.latestMeasurement.temperature}°C`},{label:"Hum",value:`${t.latestMeasurement.humidity}%`},{label:"Presión",value:t.latestMeasurement.pressure},{label:"Luz",value:t.latestMeasurement.light},{label:"UV",value:t.latestMeasurement.uv},{label:"Vel viento",value:t.latestMeasurement.windSpeed},{label:"Dir viento",value:t.latestMeasurement.windDirection},{label:"Lluvia",value:t.latestMeasurement.rainfall},{label:"RSSI",value:t.latestMeasurement.rssi},{label:"SNR",value:t.latestMeasurement.snr},{label:"Últ. Act.",value:de(t.latestMeasurement.timestamp)}],i=r===0,o=r===l-1;return e.jsxs(U,{sx:{borderRadius:0,cursor:"pointer",backgroundColor:r%2===0?"rgba(255,255,255)":"rgba(250,250,250)",borderTopLeftRadius:i?"12px":0,borderTopRightRadius:i?"12px":0,borderBottomLeftRadius:o?"12px":0,borderBottomRightRadius:o?"12px":0},onClick:s,children:[e.jsx(Pe,{title:e.jsx(M,{variant:"subtitle1",noWrap:!0,children:t.deviceName}),subheader:e.jsxs(M,{variant:"caption",noWrap:!0,children:[t.grupoName," • ",t.devEui]}),sx:{pb:1}}),e.jsx(Ue,{sx:{pt:0,pb:1,px:3,"&:last-child":{pb:1}},children:e.jsx(N,{container:!0,spacing:1,children:c.map(a=>e.jsx(N,{item:!0,xs:4,children:e.jsxs(v,{sx:{mb:1,display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(M,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:a.label}),e.jsx(M,{variant:"body2",fontWeight:"medium",noWrap:!0,sx:{fontSize:"0.8rem"},children:a.value})]})},a.label))})})]})},cr=({requestSort:t,getSortDirection:r})=>{const[l,n]=h.useState("deviceName"),[s,c]=h.useState("asc"),i=[{value:"deviceName",label:"Nombre del Dispositivo"},{value:"grupoName",label:"Rancho"},{value:"latestMeasurement.temperature",label:"Temperatura"},{value:"latestMeasurement.humidity",label:"Humedad"},{value:"latestMeasurement.light",label:"Luz"},{value:"latestMeasurement.uv",label:"UV"},{value:"latestMeasurement.windSpeed",label:"Velocidad del viento"},{value:"latestMeasurement.windDirection",label:"Dirección del viento"},{value:"latestMeasurement.rainfall",label:"Lluvia"},{value:"latestMeasurement.pressure",label:"Presión"},{value:"latestMeasurement.rssi",label:"RSSI"},{value:"latestMeasurement.snr",label:"SNR"},{value:"latestMeasurement.timestamp",label:"Última Actualización"}],o=()=>{t(l,s)};return e.jsxs(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(oe,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(le,{children:"Campo"}),e.jsx(ce,{value:l,label:"Campo",onChange:a=>n(a.target.value),children:i.map(a=>e.jsx(H,{value:a.value,children:a.label},a.value))})]}),e.jsxs(oe,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(le,{children:"Dirección"}),e.jsxs(ce,{value:s,label:"Dirección",onChange:a=>c(a.target.value),children:[e.jsx(H,{value:"asc",children:"Ascendente"}),e.jsx(H,{value:"desc",children:"Descendente"})]})]}),e.jsx(ue,{onClick:o,children:e.jsx(B,{icon:"solar:round-sort-vertical-line-duotone",width:32,color:"#1877f2"})})]})},ur=()=>{const{userData:t}=Y(),r=Re(),l=Ne(r.breakpoints.down("md")),{data:n,isError:s,isLoading:c,error:i}=O({queryKey:["user-stations"],queryFn:()=>At(t==null?void 0:t.id)}),{sortedData:o,requestSort:a,getSortDirection:d,validationErrors:p,setSearchQuery:g}=Xe(n==null?void 0:n.data,Nt,{defaultSort:{key:"deviceName",direction:"asc"},defaultSearchKeys:["deviceId","deviceName"]});return c?e.jsx(Ge,{}):s?e.jsx(ke,{message:i==null?void 0:i.message}):l?e.jsxs(v,{sx:{mt:2},children:[e.jsx(cr,{requestSort:a,getSortDirection:d}),o==null?void 0:o.map((b,T)=>{var f;return e.jsx(lr,{station:b,idx:T,totalStations:((f=n==null?void 0:n.data)==null?void 0:f.length)||0},b.id)})]}):e.jsx(Ke,{component:U,sx:{mt:2},children:e.jsxs(Ve,{children:[e.jsx(Ye,{children:e.jsxs(se,{children:[e.jsx(x,{children:"Id del dispositivo"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"deviceName",children:"Nombre del Dispositivo"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"grupoName",children:"Rancho"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.temperature",children:"Temperatura"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.humidity",children:"Humedad"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.light",children:"Luz"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.uv",children:"UV"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.windSpeed",children:"Velocidad del viento"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.windDirection",children:"Direacción del viento"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.rainfall",children:"Lluvia"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.pressure",children:"Presión"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.rssi",children:"rssi"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.snr",children:"snr"}),e.jsx(y,{requestSort:a,getSortDirection:d,sortKey:"latestMeasurement.timestamp",children:"Última Actualización"})]})}),e.jsx(Oe,{children:o==null?void 0:o.map((b,T)=>e.jsx(or,{idx:T,station:b},b.id))})]})})},dr=({sensor:t,idx:r,onCardClick:l})=>{const n=[{label:"Humedad",value:t.lastMeasurement.soilWater?`${t.lastMeasurement.soilWater}%`:"sin información"},{label:"Conductividad",value:t.lastMeasurement.soilConductivity?`${t.lastMeasurement.soilConductivity}µS/cm`:"sin información"},{label:"Temperatura",value:t.lastMeasurement.soilTemperature?`${t.lastMeasurement.soilTemperature}°C`:"sin información"},{label:"Batería",value:t.lastMeasurement.battery?`${t.lastMeasurement.battery}V`:"sin información"},{label:"Última Act.",value:de(t.lastMeasurement.timestamp)}];return e.jsxs(U,{sx:{borderRadius:0,cursor:"pointer",backgroundColor:r%2===0?"rgba(255,255,255)":"rgba(250,250,250)"},onClick:l,children:[e.jsx(Pe,{title:e.jsx(M,{variant:"subtitle1",noWrap:!0,children:t.deviceName||"Sin nombre"}),subheader:e.jsx(M,{variant:"caption",noWrap:!0,children:t.groupName||"Sin grupo asignado"}),sx:{pb:1},action:e.jsx(v,{sx:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:qe(t.lastMeasurement.timestamp),mt:2,mr:1}})}),e.jsx(Ue,{sx:{pt:0,pb:1,px:3,"&:last-child":{pb:1}},children:e.jsx(N,{container:!0,spacing:1,children:n.map(s=>e.jsx(N,{item:!0,xs:6,children:e.jsxs(v,{sx:{mb:1,display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsx(M,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:s.label}),e.jsx(M,{variant:"body2",fontWeight:"medium",noWrap:!0,sx:{fontSize:"0.8rem"},children:s.value})]})},s.label))})})]})},mr=({requestSort:t,getSortDirection:r})=>{const[l,n]=h.useState("deviceName"),[s,c]=h.useState("asc"),i=[{value:"deviceName",label:"Nombre"},{value:"lastMeasurement.soilWater",label:"Humedad"},{value:"lastMeasurement.soilConductivity",label:"Conductividad"},{value:"lastMeasurement.soilTemperature",label:"Temperatura"},{value:"lastMeasurement.battery",label:"Batería"},{value:"lastMeasurement.timestamp",label:"Última Actualización"}],o=()=>{t(l,s)};return e.jsxs(v,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(oe,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(le,{children:"Campo"}),e.jsx(ce,{value:l,label:"Campo",onChange:a=>n(a.target.value),children:i.map(a=>e.jsx(H,{value:a.value,children:a.label},a.value))})]}),e.jsxs(oe,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(le,{children:"Dirección"}),e.jsxs(ce,{value:s,label:"Dirección",onChange:a=>c(a.target.value),children:[e.jsx(H,{value:"asc",children:"Ascendente"}),e.jsx(H,{value:"desc",children:"Descendente"})]})]}),e.jsx(ue,{onClick:o,children:e.jsx(B,{icon:"solar:round-sort-vertical-line-duotone",width:32,color:"#1877f2"})})]})},hr=async t=>{if(!t)throw new Error("userId is required");try{const r=await fetch(`${ze}/api/sensors/usuario/${t}/sensores-primera-insercion`);if(!r.ok)throw new Error("Network response was not ok");const l=await r.json();return Lt.parse(l)}catch(r){throw r instanceof He.ZodError?(console.error("Validation error:",r.errors),new Error(r.message)):new Error(r)}},pr=()=>{const t=ht(),{userData:r}=Y(),l=Re(),n=Ne(l.breakpoints.down("md")),{data:s,refetch:c,isLoading:i,isError:o,error:a}=O({queryKey:[`user-sensors-${r==null?void 0:r.id}`],queryFn:()=>hr(r==null?void 0:r.id),enabled:!!(r!=null&&r.id)}),{sortedData:d,requestSort:p,getSortDirection:g,validationErrors:b,setSearchQuery:T}=Xe(s,Wt,{defaultSort:{key:"deviceName",direction:"asc"},defaultSearchKeys:["deviceId","deviceName"]});return b?e.jsx(ke,{message:"Validation Errors"}):i?e.jsx(Ge,{}):o?e.jsx(ke,{message:a.message}):e.jsxs(v,{sx:{position:"relative",paddingTop:2},children:[e.jsx(ue,{"aria-label":"actualizar",sx:{position:"absolute",top:-40,right:0},onClick:()=>c(),children:e.jsx(B,{icon:"solar:restart-circle-line-duotone",width:35})}),e.jsxs(U,{children:[e.jsx(v,{sx:{p:1},children:e.jsx(It,{onSearch:T})}),n?e.jsxs(v,{children:[e.jsx(v,{sx:{p:2},children:e.jsx(mr,{requestSort:p,getSortDirection:g})}),e.jsx(Qe,{spacing:0,sx:{mt:2},children:d.map((f,I)=>e.jsx(dr,{sensor:f,idx:I,onCardClick:()=>t(`/iot/sensor/${f.deviceId}`)},f.deviceId))})]}):e.jsx(Ke,{children:e.jsxs(Ve,{children:[e.jsx(Ye,{children:e.jsxs(se,{children:[e.jsx(x,{children:"ID"}),e.jsx(x,{children:"Nombre del Grupo"}),e.jsx(y,{requestSort:p,getSortDirection:g,sortKey:"deviceName",children:"Nombre del Dispositivo"}),e.jsx(y,{requestSort:p,getSortDirection:g,sortKey:"lastMeasurement.soilWater",children:"Humedad del Suelo"}),e.jsx(y,{requestSort:p,getSortDirection:g,sortKey:"lastMeasurement.soilConductivity",children:"Conductividad del Suelo"}),e.jsx(y,{requestSort:p,getSortDirection:g,sortKey:"lastMeasurement.soilTemperature",children:"Temperatura del Suelo"}),e.jsx(y,{requestSort:p,getSortDirection:g,sortKey:"lastMeasurement.battery",children:"Batería"}),e.jsx(y,{requestSort:p,getSortDirection:g,sortKey:"lastMeasurement.timestamp",children:"Última Actualización"}),e.jsx(x,{children:"Status"})]})}),e.jsx(Oe,{children:d.map((f,I)=>e.jsxs(se,{sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},backgroundColor:I%2===0?"rgba(255,255,255)":"rgba(250,250,250)"},onClick:()=>t(`/iot/sensor/${f.deviceId}`),children:[e.jsx(x,{children:I+1}),e.jsx(x,{children:f.groupName||"Sin grupo asignado"}),e.jsx(x,{children:f.deviceName||"Sin nombre"}),e.jsx(x,{children:f.lastMeasurement.soilWater?`${f.lastMeasurement.soilWater}%`:"sin información"}),e.jsx(x,{children:f.lastMeasurement.soilConductivity?`${f.lastMeasurement.soilConductivity}µS/cm`:"sin información"}),e.jsx(x,{children:f.lastMeasurement.soilTemperature?`${f.lastMeasurement.soilTemperature}°C`:"sin información"}),e.jsx(x,{children:f.lastMeasurement.battery?`${f.lastMeasurement.battery}V`:"sin información"}),e.jsx(x,{children:de(f.lastMeasurement.timestamp)}),e.jsx(x,{children:e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:qe(f.lastMeasurement.timestamp),margin:"0 auto"}})})]},f.deviceId))})]})})]})]})},fr=()=>{const{userData:t}=Y(),[r,l]=h.useState(0),{data:n}=O({queryKey:["user-ranches",t==null?void 0:t.id],queryFn:()=>Le(t==null?void 0:t.id),enabled:!!(t!=null&&t.id)}),s=(c,i)=>{l(i)};return e.jsxs(pt,{children:[e.jsxs(Qe,{direction:"row",justifyContent:"space-between",children:[e.jsx(M,{variant:"h4",children:"Mis dispositivos"}),e.jsx(sr,{})]}),e.jsxs(Dt,{value:r,onChange:s,"aria-label":"vistas-disponibles",sx:{mt:3},scrollButtons:"auto",variant:"scrollable",children:[e.jsx(te,{label:"Mapa",...ae(0),sx:{borderRadius:1,marginBottom:.5},icon:e.jsx(B,{icon:"solar:map-line-duotone"}),iconPosition:"start"}),e.jsx(te,{label:"Todos",...ae(1),sx:{borderRadius:1,marginBottom:.5},icon:e.jsx(B,{icon:"solar:layers-minimalistic-bold-duotone"}),iconPosition:"start"}),e.jsx(te,{label:"Estaciones",...ae(2),sx:{borderRadius:1,marginBottom:.5},icon:e.jsx(B,{icon:"solar:station-bold-duotone"}),iconPosition:"start"}),n==null?void 0:n.map((c,i)=>e.jsx(te,{label:c.name,...ae(i+3),sx:{borderRadius:1,marginBottom:.5,display:{xs:"none",sm:"block"}},icon:e.jsx(B,{icon:"solar:home-bold-duotone"}),iconPosition:"start"},c.id))]}),e.jsx(ie,{value:r,index:0,children:e.jsx(ar,{})}),e.jsx(ie,{value:r,index:1,children:e.jsx(pr,{})}),e.jsx(ie,{value:r,index:2,children:e.jsx(ur,{})}),n==null?void 0:n.map((c,i)=>e.jsx(ie,{value:r,index:i+3,children:e.jsx(Mt,{ranchId:c.id,isContentOnTab:!0})},c.id))]})};function ae(t){return{id:`simple-tab-${t}`,"aria-controls":`simple-tabpanel-${t}`}}function ie(t){const{children:r,value:l,index:n,...s}=t;return e.jsx("div",{role:"tabpanel",hidden:l!==n,id:`vista-${n}`,"aria-labelledby":`vista-${n}`,...s,children:l===n&&e.jsx(v,{sx:{mt:2},children:r})})}function Gr(){return e.jsxs(e.Fragment,{children:[e.jsx(ft,{children:e.jsxs("title",{children:[" ",`Your Sensors - ${xt.appName}`]})}),e.jsx(fr,{})]})}export{Gr as default};
