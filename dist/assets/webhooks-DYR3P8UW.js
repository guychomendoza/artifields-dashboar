import{g as O,e as R,s as L,T as k,P as B,r as i,f as H,k as A,j as e,_ as N,o as I,p as K,t as v,B as b,d as y,I as E,v as W,l as _,w as M,S as U,Q as q,D as Q,H as G}from"./index-DNJ-7_Rf.js";import{C as J}from"./config-global-CwnLHF89.js";import{u as V}from"./useQuery-Cikl35b1.js";import{u as D,S as z}from"./success-alert-D8Pc2hKc.js";import{z as j,E as f}from"./index-DnZn71We.js";import{D as Z,a as X,b as Y}from"./DialogContent-DmUc9Cb3.js";import{D as ee}from"./DialogTitle-m1-UEW8M.js";import{u as re}from"./useMediaQuery-BWWVbJPQ.js";import{c as T,d as g,T as oe,a as se,b as te,e as ae}from"./TableRow-DysWAKuU.js";import{S as ne}from"./Snackbar-Ca286brL.js";import{S as F}from"./Stack-BvggcJT0.js";import{T as w}from"./TextField-DrqQKz-z.js";import{L as $}from"./LoadingButton-ibHk8LjJ.js";import{u as S}from"./use-debounce-BKmKytjS.js";import{T as le}from"./table-loading-DNHH0sRX.js";import{C as ie}from"./Card-98N49c-B.js";import"./colorManipulator-CN4-k9CK.js";import"./useControlled-CYejl48w.js";import"./Select-C6NYPjTS.js";import"./CircularProgress-DypZclCl.js";function ce(s){return R("MuiDialogContentText",s)}O("MuiDialogContentText",["root"]);const de=["children","className"],ue=s=>{const{classes:o}=s,r=K({root:["root"]},ce,o);return N({},o,r)},he=L(k,{shouldForwardProp:s=>B(s)||s==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(s,o)=>o.root})({}),me=i.forwardRef(function(o,t){const r=H({props:o,name:"MuiDialogContentText"}),{className:a}=r,n=A(r,de),c=ue(n);return e.jsx(he,N({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:n,className:I(c.root,a)},r,{classes:c}))}),xe=j.object({message:j.string(),data:j.array(j.object({id:j.number(),modelo:j.string(),networkserver:j.string(),url:j.string()}))}).transform(s=>({message:s.message,data:s.data.map(o=>({id:o.id,model:o.modelo,networkServer:o.networkserver,url:o.url}))})),pe=async({modelFilter:s,serverFilter:o,urlFilter:t})=>{try{const r=new URLSearchParams;s&&r.append("modelo",s),o&&r.append("networkserver",o),t&&r.append("url",t);const a=await fetch(`${v}/api/webhooks?${r.toString()}`);if(!a.ok)throw new Error("Network response was not ok");const n=await a.json();if(n.message!=="Webhooks obtenidos exitosamente")throw new Error("Ha ocurrido un error al obtener los webhooks");return xe.parse(n)}catch(r){throw r instanceof j.ZodError?(console.error("Validation error:",r.errors),new Error(r.message)):new Error(`Failed to get webhooks: ${r}`)}},je=async(s,o,t)=>{try{const r=await fetch(`${v}/api/webhooks`,{method:"POST",body:JSON.stringify({modelo:s,url:o,networkserver:t}),headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error("Network response was not ok");if((await r.json()).message!=="Webhook creado exitosamente")throw new Error("Ha ocurrido un error al crear el webhook")}catch(r){throw new Error(`Failed to create webhook: ${r}`)}},ge=async s=>{try{const o=await fetch(`${v}/api/webhooks/${s}`,{method:"DELETE"});if(!o.ok)throw new Error("Network response was not ok");if((await o.json()).message!=="Webhook eliminado exitosamente")throw new Error("Ha ocurrido un error al eliminar el webhook")}catch(o){throw new Error(`Failed to delete webhook: ${o}`)}},we=async(s,o,t,r)=>{if(!s||!t||!r||!o)throw new Error("Missing data");try{const a=await fetch(`${v}/api/webhooks/${s}`,{method:"PUT",body:JSON.stringify({modelo:o,url:t,networkserver:r}),headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Network response was not ok");if((await a.json()).message!=="Webhook actualizado exitosamente")throw new Error("Ha ocurrido un error al editar el webhook")}catch(a){throw new Error(`Failed update webhook: ${a}`)}},be=({webhookModel:s,webhookId:o,refetchWebhooks:t})=>{const[r,a]=i.useState(!1),n=D({mutationKey:["delete-webhook",o],mutationFn:({id:u})=>ge(u),onSuccess:()=>{t()}}),c=()=>{a(!0)},d=()=>{a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(b,{children:e.jsx(y,{"aria-label":"borrar webhook",color:"error",onClick:c,children:e.jsx(E,{icon:"solar:trash-bin-2-bold-duotone"})})}),e.jsxs(Z,{open:r,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ee,{id:"alert-dialog-title",children:s}),e.jsx(X,{children:e.jsx(me,{id:"alert-dialog-description",children:"¿Estás seguro de que deseas eliminar este webhook? Esta acción no se puede deshacer."})}),e.jsxs(Y,{children:[e.jsx(W,{onClick:d,children:"Cancelar"}),e.jsx(W,{onClick:()=>{n.mutate({id:o})},autoFocus:!0,variant:"contained",color:"error",children:"Eliminar"})]})]})]})},fe=({id:s,model:o,networkServer:t,url:r,refetchWebhooks:a,setSelectedWebhook:n,idx:c})=>{const d=_(),u=re(d.breakpoints.down("md")),[m,x]=i.useState(!1),h=async()=>{try{await navigator.clipboard.writeText(r),x(!0)}catch(l){console.error("Failed to copy URL:",l)}};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{style:{backgroundColor:c%2===0?"rgba(255,255,255)":"rgba(250,250,250)"},children:[e.jsx(g,{children:o}),e.jsx(g,{children:t}),e.jsx(g,{children:e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsx(be,{webhookId:s,webhookModel:o,refetchWebhooks:a}),e.jsx(y,{"aria-label":"editar webhook",onClick:()=>n({id:s,model:o,networkServer:t,url:r}),children:e.jsx(E,{icon:"solar:pen-2-bold-duotone"})})]})}),e.jsx(g,{sx:{display:{xs:"none",md:"table-cell"}},children:e.jsxs(b,{sx:{display:"flex",alignItems:"center",py:1,px:2,borderRadius:1},children:[e.jsx(b,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mr:2},children:r}),e.jsx(y,{onClick:h,size:"small",sx:{flexShrink:0},children:e.jsx(E,{icon:"solar:copy-bold-duotone"})})]})})]}),u&&e.jsx(T,{children:e.jsx(g,{colSpan:4,sx:{bgcolor:"grey.50",border:"none","&:last-child":{borderBottom:1,borderColor:"divider"}},children:e.jsx(b,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},onClick:h,children:r})})}),e.jsx(ne,{open:m,autoHideDuration:2e3,onClose:()=>x(!1),message:"URL copiada al portapapeles",anchorOrigin:{vertical:"bottom",horizontal:"center"}})]})},ke=({refetchWebhooks:s,onClose:o,isOpen:t,webhook:r})=>{const[a,n]=i.useState(""),[c,d]=i.useState(""),[u,m]=i.useState("");i.useEffect(()=>{d(r==null?void 0:r.url),m(r==null?void 0:r.networkServer),n(r==null?void 0:r.model)},[r]);const x=D({mutationKey:["create-new-webhook",t,r.id],mutationFn:({id:l,newModel:p,newUrl:C,newNetworkServer:P})=>we(l,p,C,P),onSuccess:()=>{s()}}),h=()=>{!a||!c||!u||!r.id||x.mutate({id:r.id,newModel:a,newUrl:c,newNetworkServer:u})};return e.jsx(M,{open:t,onClose:o,anchor:"right",sx:{height:"100vh"},children:e.jsx(U,{children:e.jsxs(b,{sx:{width:{xs:300,sm:500,md:600},p:{xs:1.5,sm:4}},children:[e.jsxs(k,{variant:"subtitle1",children:["Editar ",r==null?void 0:r.model]}),e.jsxs(F,{direction:"column",spacing:2,mt:2,children:[e.jsx(w,{fullWidth:!0,size:"small",label:"Modelo",value:a,onChange:l=>n(l.target.value)}),e.jsx(w,{fullWidth:!0,size:"small",label:"Url",value:c,onChange:l=>d(l.target.value)}),e.jsx(w,{fullWidth:!0,size:"small",label:"Network service",value:u,onChange:l=>m(l.target.value)})]}),e.jsx($,{variant:"contained",fullWidth:!0,sx:{my:2},onClick:h,loading:x.isPending,disabled:x.isPending,children:"Actualizar webhook"}),x.isError&&e.jsx(f,{message:`${x.error}`}),x.isSuccess&&e.jsx(z,{message:"webhook actualizado"})]})})})},ve=({setModelFilter:s,setNetworkServerFilter:o,setUrlFilter:t})=>{const[r,a]=i.useState(""),[n,c]=i.useState(""),[d,u]=i.useState(""),m=S(r,500),x=S(n,500),h=S(d,500);return i.useEffect(()=>{s(m)},[m]),i.useEffect(()=>{o(x)},[x]),i.useEffect(()=>{t(h)},[h]),e.jsxs(F,{direction:"column",spacing:1,children:[e.jsx(w,{size:"small",placeholder:"modelo",label:"modelo",value:r,onChange:l=>a(l.target.value)}),e.jsx(w,{size:"small",placeholder:"servidor de red",label:"servidor de red",value:n,onChange:l=>c(l.target.value)}),e.jsx(w,{size:"small",placeholder:"url",label:"url",value:d,onChange:l=>u(l.target.value)})]})},Ce=({refetchWebhooks:s})=>{const[o,t]=i.useState(!1),[r,a]=i.useState(""),[n,c]=i.useState(""),[d,u]=i.useState(""),m=D({mutationKey:["create-new-webhook",o],mutationFn:({newModel:h,newUrl:l,newNetworkServer:p})=>je(h,l,p),onSuccess:()=>{a(""),c(""),u(""),s()}}),x=()=>{!r||!n||!d||m.mutate({newModel:r,newUrl:n,newNetworkServer:d})};return e.jsxs(e.Fragment,{children:[e.jsx(F,{direction:"row",justifyContent:"flex-end",children:e.jsx(W,{variant:"contained",color:"inherit",size:"small",onClick:()=>t(!0),children:"Crear Webhook"})}),e.jsx(M,{open:o,onClose:()=>t(!1),anchor:"right",sx:{height:"100vh"},children:e.jsx(U,{children:e.jsxs(b,{sx:{width:{xs:300,sm:500,md:600},p:{xs:1.5,sm:4}},children:[e.jsx(k,{variant:"subtitle1",children:"Crear un nuevo webhook"}),e.jsx(w,{fullWidth:!0,size:"small",label:"Modelo",sx:{mt:2},value:r,onChange:h=>a(h.target.value)}),e.jsx(w,{fullWidth:!0,size:"small",label:"Url",sx:{mt:1},value:n,onChange:h=>c(h.target.value)}),e.jsx(w,{fullWidth:!0,size:"small",label:"Network service",sx:{mt:1},value:d,onChange:h=>u(h.target.value)}),e.jsx($,{variant:"contained",fullWidth:!0,sx:{my:2},onClick:x,loading:m.isPending,disabled:m.isPending,children:"Crear webhook"}),m.isError&&e.jsx(f,{message:`${m.error}`}),m.isSuccess&&e.jsx(z,{message:"webhook creado"})]})})})]})},Se=()=>{const[s,o]=i.useState(""),[t,r]=i.useState(""),[a,n]=i.useState(""),[c,d]=i.useState(null),{data:u,isLoading:m,isError:x,error:h,refetch:l}=V({queryKey:["webhooks",s,t,a],queryFn:()=>pe({modelFilter:s,serverFilter:t,urlFilter:a}),placeholderData:q});return m?e.jsx(le,{}):x?e.jsx(f,{message:h.message}):u?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{refetchWebhooks:l}),e.jsxs(ie,{sx:{mt:1},children:[e.jsx(b,{sx:{p:1},children:e.jsx(ve,{setModelFilter:o,setNetworkServerFilter:r,setUrlFilter:n})}),e.jsx(oe,{children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(T,{children:[e.jsx(g,{children:"Modelo"}),e.jsx(g,{children:"Servidor de red"}),e.jsx(g,{children:"Acciones"}),e.jsx(g,{sx:{display:{xs:"none",md:"table-cell"}},children:"Url"})]})}),e.jsx(ae,{children:u==null?void 0:u.data.map((p,C)=>e.jsx(fe,{id:p.id,model:p.model,url:p.url,networkServer:p.networkServer,refetchWebhooks:l,setSelectedWebhook:d,idx:C},p.id))})]})})]}),c?e.jsx(ke,{refetchWebhooks:l,onClose:()=>d(null),isOpen:!0,webhook:c}):null]}):e.jsx(f,{message:"Sin Datos"})};function ye(){return e.jsxs(Q,{children:[e.jsx(k,{variant:"h4",children:"Webhooks"}),e.jsx(Se,{})]})}function qe(){return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs("title",{children:[" ",`Weebhooks - ${J.appName}`]})}),e.jsx(ye,{})]})}export{qe as default};
