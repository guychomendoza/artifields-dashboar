import{a5 as z,j as e,az as N,T as f,r as o,E as x,v as c,aL as _,D as A,H as B}from"./index-DNJ-7_Rf.js";import{C as G}from"./config-global-CwnLHF89.js";import{C as k}from"./Card-98N49c-B.js";import{C as F}from"./CardContent-DR76uJN9.js";import{S as u}from"./Stack-BvggcJT0.js";import{u as O,c as R}from"./users-Dd3MPzKO.js";import{T as d}from"./TextField-DrqQKz-z.js";import{C as T}from"./CircularProgress-DypZclCl.js";import"./Select-C6NYPjTS.js";import"./useControlled-CYejl48w.js";const V=()=>{const{userData:r}=z();return e.jsx(k,{children:e.jsx(F,{children:e.jsxs(u,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(N,{sx:{width:56,height:56},children:r!=null&&r.nombre?r.nombre[0]:""}),e.jsxs(u,{direction:"column",children:[e.jsx(f,{variant:"subtitle1",children:r==null?void 0:r.nombre}),e.jsx(f,{variant:"body2",children:r==null?void 0:r.correo})]})]})})})},$=()=>{const{userData:r}=z(),[i,h]=o.useState(!1),[n,g]=o.useState(!1),[j,v]=o.useState(!1),[H,P]=o.useState(!1),[L,w]=o.useState(!1),[y,m]=o.useState(""),[S,l]=o.useState(""),[a,U]=o.useState({nombre:(r==null?void 0:r.nombre)||"",correo:(r==null?void 0:r.correo)||"",telefono:(r==null?void 0:r.telefono)||""}),[t,p]=o.useState({newPassword:"",confirmPassword:""}),C=(s,b)=>{U({...a,[s]:b})},E=(s,b)=>{p({...t,[s]:b})},W=async()=>{if(r){if(!a.nombre||!a.correo){m("Tu nombre o correo no pueden estar vacíos");return}g(!0),P(!1),m("");try{if(!await O(r.id,{nombre:a.nombre,correo:a.correo,tipo_usuario:r.tipo_usuario,telefono:a.telefono,chatbot_whats:r.chatbot_whats})){m("Hubo un error al actualizar tus datos");return}P(!0),h(!1)}catch{m("Hubo un error al actualizar el perfil. Inténtalo de nuevo.")}finally{g(!1)}}},I=async()=>{if(r){if(t.newPassword!==t.confirmPassword){l("Las contraseñas no coinciden");return}v(!0),w(!1),l("");try{if(!await R(r.id,t.newPassword)){l("Hubo un error al cambiar la contraseña");return}w(!0),p({newPassword:"",confirmPassword:""})}catch{l("Hubo un error al cambiar la contraseña. Inténtalo de nuevo.")}finally{v(!1)}}};return e.jsx(k,{sx:{marginTop:"1rem"},children:e.jsxs(F,{children:[e.jsx(f,{variant:"h5",gutterBottom:!0,children:"Tu información"}),e.jsxs(u,{spacing:3,children:[H&&e.jsx(x,{severity:"success",children:"Perfil actualizado correctamente."}),y&&e.jsx(x,{severity:"error",children:y}),e.jsx(d,{label:"Nombre",value:a.nombre,disabled:!i||n,onChange:s=>C("nombre",s.target.value),fullWidth:!0}),e.jsx(d,{label:"Correo Electrónico",value:a.correo,disabled:!i||n,onChange:s=>C("correo",s.target.value),fullWidth:!0}),e.jsx(d,{label:"Teléfono",value:a.telefono,disabled:!i||n,onChange:s=>C("telefono",s.target.value),fullWidth:!0}),e.jsx(u,{direction:"row",spacing:2,justifyContent:"flex-end",children:i?e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outlined",onClick:()=>h(!1),disabled:n,children:"Cancelar"}),e.jsx(c,{variant:"contained",color:"primary",onClick:W,disabled:n,children:n?e.jsx(T,{size:24}):"Guardar"})]}):e.jsx(c,{variant:"contained",color:"primary",onClick:()=>h(!0),children:"Editar"})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx(f,{variant:"h6",children:"Cambiar Contraseña"}),L&&e.jsx(x,{severity:"success",children:"Contraseña actualizada correctamente."}),S&&e.jsx(x,{severity:"error",children:S}),e.jsx(d,{label:"Nueva Contraseña",type:"password",value:t.newPassword,onChange:s=>E("newPassword",s.target.value),fullWidth:!0}),e.jsx(d,{label:"Confirmar Contraseña",type:"password",value:t.confirmPassword,onChange:s=>E("confirmPassword",s.target.value),fullWidth:!0}),e.jsxs(u,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(c,{variant:"outlined",onClick:()=>{p({newPassword:"",confirmPassword:""}),l(""),w(!1),h(!1)},disabled:j,children:"Cancelar"}),e.jsx(c,{variant:"contained",color:"error",onClick:I,disabled:j,children:j?e.jsx(T,{size:24}):"Cambiar Contraseña"})]})]})]})]})})};function q(){return e.jsxs(A,{children:[e.jsx(f,{variant:"h4",children:"Profile"}),e.jsx(V,{}),e.jsx($,{})]})}function se(){return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs("title",{children:[" ",`Profile - ${G.appName}`]})}),e.jsx(q,{})]})}export{se as default};
