import{x as O,u as F,r,j as e,B as l,T as f,$ as c,aO as g,v as y,d as j,t as C,H}from"./index-DNJ-7_Rf.js";import{C as R}from"./config-global-CwnLHF89.js";import{C as V}from"./CircularProgress-DypZclCl.js";import{C as v}from"./Card-98N49c-B.js";import{C as D}from"./CardHeader-BODd0mTE.js";import{C as z}from"./CardContent-DR76uJN9.js";import{T as w}from"./TextField-DrqQKz-z.js";import{I as b}from"./InputAdornment-CuTnuXim.js";import"./Select-C6NYPjTS.js";import"./useControlled-CYejl48w.js";const G=()=>{const k=O(),{token:o}=F(),[P,d]=r.useState(!1),[S,x]=r.useState(!0),[T,I]=r.useState(!1),[a,E]=r.useState(""),[u,L]=r.useState(""),[i,A]=r.useState(!1),[m,n]=r.useState("");r.useEffect(()=>{(async()=>{x(!0);try{if(!o){d(!1);return}const t=await fetch(`${C}/api/users/verify-reset-token/${o}`),h=await t.json();t.status===400&&h.message==="Token inválido o expirado"?d(!1):d(!0)}catch(t){console.error("Error verifying token:",t),d(!1)}finally{x(!1)}})()},[o]);const N=s=>{E(s.target.value),s.target.value.length<8?n("La contraseña debe tener al menos 8 caracteres"):n("")},W=s=>{L(s.target.value)},$=async s=>{if(s.preventDefault(),a!==u){n("Las contraseñas no coinciden");return}if(a.length<8){n("La contraseña debe tener al menos 8 caracteres");return}try{const t=await fetch(`${C}/api/users/reset-password/${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nuevaContraseña:a})}),h=await t.json();t.ok&&h.message==="Contraseña actualizada correctamente"?I(!0):n(h.message||"Error al configurar la contraseña")}catch(t){console.error("Error setting password:",t),n("Error de red. Inténtalo de nuevo.")}},p=()=>{A(!i)},B=()=>{k("/")};return S?e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:e.jsx(V,{})}):o?P?T?e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"background.default"},children:e.jsxs(v,{sx:{maxWidth:400,width:"100%",p:2,textAlign:"center"},children:[e.jsx(c,{icon:"mdi:check-circle",width:64,color:g[500],style:{margin:"0 auto",display:"block"}}),e.jsx(f,{variant:"h6",color:"success.main",sx:{mt:2,mb:2,color:g[600]},children:"Contraseña configurada correctamente"}),e.jsx(y,{variant:"contained",color:"primary",onClick:B,sx:{mt:2},children:"Iniciar Sesión"})]})}):e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",backgroundColor:"background.default"},children:e.jsxs(v,{sx:{maxWidth:400,width:"100%",p:2},children:[e.jsx(D,{title:"Crea tu contraseña",subheader:"Termina de configurar tu cuenta",titleTypographyProps:{variant:"h5",align:"center"},subheaderTypographyProps:{variant:"subtitle2",align:"center"}}),e.jsx(z,{children:e.jsxs("form",{onSubmit:$,children:[e.jsx(w,{fullWidth:!0,type:i?"text":"password",label:"Contraseña",variant:"outlined",margin:"normal",value:a,onChange:N,error:!!m,helperText:m,InputProps:{endAdornment:e.jsx(b,{position:"end",children:e.jsx(j,{"aria-label":"toggle password visibility",onClick:p,edge:"end",children:i?e.jsx(c,{icon:"mdi:eye-off-outline",width:24}):e.jsx(c,{icon:"mdi:eye-outline",width:24})})})}}),e.jsx(w,{fullWidth:!0,type:i?"text":"password",label:"Confirmar Contraseña",variant:"outlined",margin:"normal",value:u,onChange:W,error:!!m&&a!==u,helperText:a!==u?"Las contraseñas no coinciden":"",InputProps:{endAdornment:e.jsx(b,{position:"end",children:e.jsx(j,{"aria-label":"toggle password visibility",onClick:p,edge:"end",children:i?e.jsx(c,{icon:"mdi:eye-off-outline",width:24}):e.jsx(c,{icon:"mdi:eye-outline",width:24})})})}}),e.jsx(y,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",sx:{mt:2,py:1.5},children:"Establecer Contraseña"})]})})]})}):e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:e.jsx(f,{variant:"subtitle1",sx:{textAlign:"center",maxWidth:"65ch"},children:"Lo sentimos, link no válido, contacta con el administrador para generar uno nuevo"})}):e.jsx(l,{children:e.jsx(f,{variant:"h1",color:"textSecondary",children:"Lo sentimos, link no válido"})})};function ee(){return e.jsxs(e.Fragment,{children:[e.jsx(H,{children:e.jsxs("title",{children:[" ",`Asignar Contraseña - ${R.appName}`]})}),e.jsx(G,{})]})}export{ee as default};
